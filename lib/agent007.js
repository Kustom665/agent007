/*! 
* @license agent007 - v0.0.1
* (c) 2013 Julien VALERY https://github.com/darul75/agent007
* License: MIT 
*/
function Agent007(){this.init()}var fs=require("fs"),Index=require("node-index"),xml2js=require("xml2js"),xml="useragentswitcher.xml",LegacyBrowsers="Legacy Browsers",ConsoleBrowsers="Console Browsers",Browsers="Browsers",Devices="Devices",OS="OS",key=0,node=[];Agent007.prototype.init=function(){var a=new xml2js.Parser,b=this;return fs.readFile(xml,function(c,d){a.parseString(d,function(a,c){b.index=new Index,b.nodeIt(c.useragentswitcher.folder,node,!0);b.query("Firefox");console.log("loaded")})}),this},Agent007.prototype.query=function(a){return this.index.query(a)},Agent007.prototype.nodeIt=function(a,b,c){if(b.children=[],a){for(var d=0;d<a.length;d++){var e=a[d],f=e.$.description;if(f){var g={name:f};g.path=b.path?b.path+" / "+f:f,this.fetchUserAgents(e.useragent,g),c?(b.push(g),this.nodeIt(e.folder,g,!1)):(b.children.push(g),this.nodeIt(e.folder,g,!1))}}return this}},Agent007.prototype.fetchUserAgents=function(a,b){if(a){b.useragent=[];for(var c=0;c<a.length;c++){var d=a[c],e=d.$.description,f=d.$.useragent;b.useragent.push({description:e,value:f,path:b.path}),this.index.addDocument(key,{path:b.path,description:e,userAgent:f}),key++}return this}};var agent007=new Agent007;module.exports=agent007;