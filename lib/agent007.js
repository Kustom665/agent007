/*! 
* @license agent007 - v0.0.1
* (c) 2013 Julien VALERY https://github.com/darul75/agent007
* License: MIT 
*/
function Agent007(){this.init()}var fs=require("fs"),Index=require("node-index"),xml2js=require("xml2js"),xml="useragentswitcher.xml",Bill="Windows",Steve="Mac",Lyn="Linux",Unix="Unix",Mobile="MobileDevices",LegacyBrowsers="LegacyBrowsers",ConsoleBrowsers="ConsoleBrowsers",Browsers="Browsers",Devices="Devices",Tablets="Tablets",TabletsApple="AppleiPhoneetc",AmazonKindle="AmazonKindle",OS="OS",key=0,types=[],useragents=[],node=[];Agent007.prototype.init=function(){var a=new xml2js.Parser,b=this;return fs.readFile(xml,function(c,d){a.parseString(d,function(a,c){b.indexUserAgent=new Index,b.indexCategory=new Index,nodeIt.apply(b,[c.useragentswitcher.folder,node,!0]);b.getTypes()})}),this},Agent007.prototype.findAgents=function(a){var b=[],c=this.indexUserAgent.query(a);if(!c||0===c.length)return b;for(var d=0;d<c.length;d++)b.push(useragents[c[d].key]);return b},Agent007.prototype.findRandomAgent=function(a){var b=this.indexUserAgent.query(a);if(!b||0===b.length)return"";var c=Math.floor(Math.random()*b.length-1+1);return useragents[b[c].key]},Agent007.prototype.findAgentsByType=function(a){var b=[];a=a.replace(/\//g,"");var c=this.indexCategory.query(a);if(!c||0===c.length)return b;for(var d=0;d<c.length;d++)b.push(useragents[c[d].key]);return b},Agent007.prototype.findRandomAgentByType=function(a){a=a.replace(/\//g,"");var b=this.indexCategory.query(a);if(!b||0===b.length)return"";var c=Math.floor(Math.random()*b.length-1+1);return useragents[b[c].key]},Agent007.prototype.getTypes=function(){return types},Agent007.prototype.getTree=function(){return node};var nodeIt=function(a,b,c){if(b.children=[],a){for(var d=0;d<a.length;d++){var e=a[d],f=e.$.description.replace(/[\(\)\/\- ]|Browsers - /g,"");if(f){var g={name:f};g.path=b.path?b.path+"/"+f:f,g.index=b.index?b.index+f:f,types.push(g.path),fetchUserAgents.apply(this,[e.useragent,g]),c?b.push(g):b.children.push(g),nodeIt.apply(this,[e.folder,g,!1])}}return this}},fetchUserAgents=function(a,b){if(a){b.useragent=[];for(var c=0;c<a.length;c++){var d=a[c],e=d.$.description,f=d.$.useragent;b.useragent.push({description:e,value:f,path:b.path}),this.indexUserAgent.addDocument(key,{userAgent:f}),this.indexCategory.addDocument(key,{path:b.index}),useragents[key]=f,key++}return this}},agent007=new Agent007;module.exports=agent007;